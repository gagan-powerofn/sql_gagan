CREATE TABLE EMPLOYEE(
ID CHAR(4) PRIMARY KEY,
NAME VARCHAR(20)NOT NULL,
DEPARTMENT CHAR(4) NOT NULL,
ACTIVE ENUM('0','1') NOT NULL,
GENDER ENUM('M','F') NOT NULL,
ROLE_ID CHAR(4) NOT NULL);

LOAD DATA LOCAL INFILE '/home/gagan/emp.csv' INTO TABLE EMPLOYEE FIELDS TERM
INATED BY ',';

CREATE TABLE DEPARTMENT(
ID CHAR(4) PRIMARY KEY,
NAME VARCHAR(20) NOT NULL)

INSERT INTO DEPARTMENT VALUES 
('D001','DEVELOPMENT'), 
('D002','HR');

CREATE TABLE ROLES(
ID CHAR(4) PRIMARY KEY,
NAME VARCHAR(25) NOT NULL);

INSERT INTO ROLES VALUES 
('R001','TEAM LEAD'), 
('R002','SR. DEVELOPER'), 
('R003','DEVELOPER'), 
('R004','MANAGER'), 
('R005','SR. MANAGER'), 
('R006','EXE. MANAGER');

CREATE TABLE REPORTING(
ID CHAR(4) PRIMARY KEY,
L2 CHAR(4), 
L1 CHAR(4));

LOAD DATA LOCAL INFILE '/home/gagan/reporting.csv'INTO TABLE REPORTING FIELD
S TERMINATED BY ',';

INSERT INTO REPORTING VALUES
('E010','E008','E007');

CREATE TABLE EMP_ACTIVE_DATE(
ID CHAR(4) PRIMARY KEY,
ACTIVE_FROM DATE NOT NULL,
RESIGNED_ON DATE);

LOAD DATA LOCAL INFILE '/home/gagan/active.csv' INTO TABLE EMP_ACTIVE_DATE FIELDS 
TERMINATED BY ',';

--Question 1: GET EMPLOYESS STRENGTH IN EACH DEPARTMENT 
SELECT EMPLOYEE.DEPARTMENT AS ID, DEPARTMENT.NAME AS DEPARTMENT, COUNT(EMPLOYEE.DEPARTMENT) AS STRENGTH
FROM EMPLOYEE
JOIN DEPARTMENT
ON DEPARTMENT.ID=EMPLOYEE.DEPARTMENT
GROUP BY DEPARTMENT.NAME

--Question 2: LIST EACH EMPLOYEES L2, L1 REPORTING SENIORS
SELECT EMPLOYEE.ID,EMPLOYEE.NAME AS EMPLOYEE ,COALESCE(E1.NAME,'-') AS L2,COALESCE(E2.NAME,'-') AS L1
FROM EMPLOYEE
LEFT JOIN REPORTING
ON EMPLOYEE.ID=REPORTING.ID
LEFT JOIN EMPLOYEE E1
ON E1.ID=REPORTING.L2
LEFT JOIN EMPLOYEE E2
ON E2.ID=REPORTING.L1;

--Question 3: PROVIDE DETAILED EMPLOYEE REPORT ALL EMPLOYEES (Need to format)
SELECT EMPLOYEE.ID, EMPLOYEE.NAME AS EMPLOYEE, EMPLOYEE.DEPARTMENT AS DEPARTMENT, ROLES.NAME AS ROLE, IF(EMPLOYEE.ACTIVE = '1', 'ACTIVE', 'RESIGN') AS STATUS, IF(EMPLOYEE.GENDER = 'M','MALE','FEMALE') AS GENDER, IF(EMPLOYEE.ACTIVE = '0', DATEDIFF(EMP_ACTIVE_DATE.RESIGNED_ON, EMP_ACTIVE_DATE.ACTIVE_FROM), DATEDIFF(CURRENT_DATE(),EMP_ACTIVE_DATE.ACTIVE_FROM)) AS TERM
FROM EMPLOYEE
JOIN ROLES 
ON ROLES.ID=EMPLOYEE.ROLE_ID
JOIN EMP_ACTIVE_DATE
ON EMP_ACTIVE_DATE.ID=EMPLOYEE.ID;

SELECT 2403 DIV 365, (2403-(2403 DIV 365)*365) DIV 31;

--Question 4: GET LIST OF ALL EMPLOYEES WHO HAS PART OF OUR TEAM FOR MORE THAN 1500 DAYS
SELECT EMPLOYEE.ID, EMPLOYEE.NAME AS EMPLOYEE, EMPLOYEE.DEPARTMENT, IF(EMPLOYEE.ACTIVE = '0', DATEDIFF(EMP_ACTIVE_DATE.RESIGNED_ON, EMP_ACTIVE_DATE.ACTIVE_FROM ), DATEDIFF(CURRENT_DATE(),EMP_ACTIVE_DATE.ACTIVE_FROM)) AS DAYS 
FROM EMPLOYEE 
JOIN EMP_ACTIVE_DATE
ON EMP_ACTIVE_DATE.ID=EMPLOYEE.ID
WHERE (SELECT IF(EMPLOYEE.ACTIVE = '0', DATEDIFF(EMP_ACTIVE_DATE.RESIGNED_ON, EMP_ACTIVE_DATE.ACTIVE_FROM ), DATEDIFF(CURRENT_DATE(),EMP_ACTIVE_DATE.ACTIVE_FROM)))>1500;

--Question 5: CALCULATE THE STRENGTH (IN RATIO) OF FEMALE EMPLOYEES IN EACH DEPARTMENT
SELECT DEPARTMENT.NAME, FORMAT(SUM(CASE WHEN GENDER='F' THEN 1 ELSE 0 END)/COUNT(*)*100,2) AS PERCENTAGE
FROM DEPARTMENT
JOIN EMPLOYEE
ON EMPLOYEE.DEPARTMENT=DEPARTMENT.ID
GROUP BY DEPARTMENT.NAME;



